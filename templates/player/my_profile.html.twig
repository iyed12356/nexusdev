{% extends 'base.html.twig' %}

{% block title %}My Player Profile - NexusPlay{% endblock %}

{% block body %}
<section class="np-section">
    <div class="container">
        <div class="row">
            <!-- Player Card -->
            <div class="col-md-4">
                <div class="np-card" style="text-align: center; padding: 2rem;">
                    {% if player.profilePicture %}
                        <img src="{{ asset('uploads/logos/' ~ player.profilePicture) }}" alt="{{ player.nickname }}" style="width: 150px; height: 150px; border-radius: 50%; object-fit: cover; margin-bottom: 1rem;">
                    {% else %}
                        <div style="width: 150px; height: 150px; border-radius: 50%; background: var(--np-surface); display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; font-size: 4rem;">üéÆ</div>
                    {% endif %}
                    
                    <h2 style="margin-bottom: 0.5rem;">{{ player.nickname }}</h2>
                    <p class="np-text-muted" style="margin-bottom: 1rem;">@{{ player.user.username }}</p>
                    
                    <div style="display: inline-block; padding: 0.5rem 1rem; background: var(--np-primary); color: white; border-radius: 20px; font-weight: bold; margin-bottom: 1rem;">
                        {{ player.rank ?? 'Unranked' }}
                    </div>
                    
                    {% if player.isPro %}
                        <div style="display: inline-block; padding: 0.25rem 0.75rem; background: gold; color: black; border-radius: 15px; font-size: 0.85rem; font-weight: bold;">PRO PLAYER</div>
                    {% endif %}
                    
                    {# Riot Games Rank Badge #}
                    {% set lolStats = null %}
                    {% for stat in player.statistics %}
                        {% if stat.game and stat.game.name == 'League of Legends' and stat.rankTier %}
                            {% set lolStats = stat %}
                        {% endif %}
                    {% endfor %}
                    
                    {% if lolStats %}
                        <div style="margin-top: 1rem;">
                            <div style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: linear-gradient(135deg, #1e2328 0%, #0f1419 100%); border: 2px solid 
                                {% if lolStats.rankTier == 'CHALLENGER' %}#f8c537
                                {% elseif lolStats.rankTier == 'GRANDMASTER' %}#ff4d4d
                                {% elseif lolStats.rankTier == 'MASTER' %}#9b59b6
                                {% elseif lolStats.rankTier == 'DIAMOND' %}#3498db
                                {% elseif lolStats.rankTier == 'PLATINUM' %}#2ecc71
                                {% elseif lolStats.rankTier == 'GOLD' %}#f1c40f
                                {% elseif lolStats.rankTier == 'SILVER' %}#95a5a6
                                {% elseif lolStats.rankTier == 'BRONZE' %}#d35400
                                {% else %}#7f8c8d
                                {% endif %}; border-radius: 8px; color: white;">
                                <img src="https://opgg-static.akamaized.net/images/medals_new/{{ lolStats.rankTier|lower|replace({'√©': 'e'}) }}.png" alt="{{ lolStats.rankTier }}" style="width: 32px; height: 32px;" onerror="this.style.display='none'">
                                <div style="text-align: left;">
                                    <div style="font-weight: bold; font-size: 0.9rem;">{{ lolStats.rankTier }} {{ lolStats.rankDivision }}</div>
                                    <div style="font-size: 0.75rem; opacity: 0.8;">{{ lolStats.leaguePoints }} LP</div>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                    
                    <hr style="border-color: var(--np-border); margin: 1.5rem 0;">
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; text-align: center;">
                        <div>
                            <div style="font-size: 1.5rem; font-weight: bold; color: var(--np-primary);">{{ player.score }}</div>
                            <div class="np-text-muted" style="font-size: 0.85rem;">Points</div>
                        </div>
                        <div>
                            <div style="font-size: 1.5rem; font-weight: bold; color: var(--np-primary);">{{ player.statistics.matches_played ?? 0 }}</div>
                            <div class="np-text-muted" style="font-size: 0.85rem;">Matches</div>
                        </div>
                    </div>
                </div>
                
                <div class="np-card" style="margin-top: 1rem; padding: 1.5rem;">
                    <h4 style="margin-bottom: 1rem;">üîó Riot Games Account</h4>
                    {% if player.user.riotSummonerName %}
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                            <div style="width: 40px; height: 40px; background: var(--np-primary); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">‚öîÔ∏è</div>
                            <div>
                                <div style="font-weight: bold;">{{ player.user.riotSummonerName }}</div>
                                <div style="font-size: 0.85rem; color: var(--np-text-muted);">Region: {{ player.user.riotRegion|upper|default('EUW') }}</div>
                            </div>
                        </div>
                        {% if player.user.riotLastSyncAt %}
                            <div style="font-size: 0.8rem; color: var(--np-text-muted); margin-bottom: 1rem;">
                                üîÑ Last synced: {{ player.user.riotLastSyncAt|date('M d, Y H:i') }}
                            </div>
                        {% endif %}
                        <button onclick="syncRiotStats()" class="btn btn-primary w-100" id="syncBtn">
                            üîÑ Sync Stats Now
                        </button>
                    {% else %}
                        <p class="np-text-muted" style="margin-bottom: 1rem;">Link your League of Legends account to sync stats automatically.</p>
                        <a href="{{ path('front_player_edit', {'id': player.id}) }}" class="btn btn-outline-primary w-100">
                            ‚ûï Add Riot Account
                        </a>
                    {% endif %}
                </div>
                
                <div class="np-card" style="margin-top: 1rem; padding: 1.5rem;">
                    <h4 style="margin-bottom: 1rem;">Quick Actions</h4>
                    <a href="{{ path('app_player_statistics', {'id': player.id}) }}" class="btn btn-outline-primary w-100 mb-2">üìä View Statistics</a>
                    <a href="{{ path('front_coach_index') }}" class="btn btn-outline-primary w-100 mb-2">üë®‚Äçüè´ Find Coach</a>
                    <a href="{{ path('front_team_index') }}" class="btn btn-outline-primary w-100">üë• Find Team</a>
                </div>
            </div>
            
            <!-- Player Details -->
            <div class="col-md-8">
                <div class="np-card" style="padding: 2rem;">
                    <h3 style="margin-bottom: 1.5rem;">Player Information</h3>
                    
                    <table class="table np-table">
                        <tbody>
                            <tr>
                                <td><strong>Game</strong></td>
                                <td>{{ player.game ? player.game.name : 'Not selected' }}</td>
                            </tr>
                            <tr>
                                <td><strong>Role</strong></td>
                                <td>{{ player.role ?? 'Not set' }}</td>
                            </tr>
                            <tr>
                                <td><strong>Nationality</strong></td>
                                <td>{{ player.nationality ?? 'Not set' }}</td>
                            </tr>
                            <tr>
                                <td><strong>Real Name</strong></td>
                                <td>{{ player.realName ?? 'Private' }}</td>
                            </tr>
                            <tr>
                                <td><strong>Team</strong></td>
                                <td>{{ player.team ? player.team.name : 'No team' }}</td>
                            </tr>
                            <tr>
                                <td><strong>Member Since</strong></td>
                                <td>{{ player.createdAt|date('F Y') }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="np-card" style="margin-top: 1rem; padding: 2rem;">
                    <h3 style="margin-bottom: 1.5rem;">Performance Overview</h3>
                    
                    {% if player.statistics %}
                        <div class="row">
                            <div class="col-md-3 text-center mb-3">
                                <div style="font-size: 2rem; font-weight: bold; color: var(--np-success);">{{ player.statistics.wins ?? 0 }}</div>
                                <div class="np-text-muted">Wins</div>
                            </div>
                            <div class="col-md-3 text-center mb-3">
                                <div style="font-size: 2rem; font-weight: bold; color: var(--np-danger);">{{ player.statistics.losses ?? 0 }}</div>
                                <div class="np-text-muted">Losses</div>
                            </div>
                            <div class="col-md-3 text-center mb-3">
                                <div style="font-size: 2rem; font-weight: bold; color: var(--np-primary);">{{ player.statistics.win_rate ?? 0 }}%</div>
                                <div class="np-text-muted">Win Rate</div>
                            </div>
                            <div class="col-md-3 text-center mb-3">
                                <div style="font-size: 2rem; font-weight: bold; color: var(--np-info);">{{ (player.statistics.kills ?? 0) + (player.statistics.assists ?? 0) }}</div>
                                <div class="np-text-muted">K+A</div>
                            </div>
                        </div>
                    {% else %}
                        <div class="np-empty">
                            <p>No statistics available yet. Start playing to see your stats!</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script>
function syncRiotStats() {
    const btn = document.getElementById('syncBtn');
    btn.disabled = true;
    btn.innerHTML = 'üîÑ Syncing...';
    
    fetch('/player/riot/sync-stats', {
        method: 'POST',
        headers: {
            'X-Requested-With': 'XMLHttpRequest'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            btn.innerHTML = '‚úÖ Synced!';
            setTimeout(() => {
                window.location.reload();
            }, 1000);
        } else {
            btn.disabled = false;
            btn.innerHTML = 'üîÑ Sync Stats Now';
            alert(data.error || 'Failed to sync stats');
        }
    })
    .catch(error => {
        btn.disabled = false;
        btn.innerHTML = 'üîÑ Sync Stats Now';
        alert('Error syncing stats: ' + error.message);
    });
}
</script>
{% endblock %}

