{% extends 'base.html.twig' %}

{% block title %}{{ player.nickname }} Statistics - NexusPlay{% endblock %}

{% block body %}
<section class="np-section">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="np-card" style="padding: 2rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <div>
                            <h1 class="np-section-title">üìä {{ player.nickname }} Statistics</h1>
                            <p class="np-text-muted">Detailed performance metrics and career stats</p>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 2rem; font-weight: bold; color: var(--np-primary);">{{ player.rank ?? 'Unranked' }}</div>
                            <div class="np-text-muted">Current Rank</div>
                        </div>
                    </div>
                    
                    {% if statistics is not empty %}
                        <div class="row" style="margin-bottom: 2rem;">
                            <div class="col-md-3">
                                <div class="np-card" style="text-align: center; padding: 1.5rem; background: var(--np-surface);">
                                    <div style="font-size: 2.5rem; font-weight: bold; color: var(--np-success);">{{ statistics.matches_played ?? 0 }}</div>
                                    <div class="np-text-muted">Matches Played</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="np-card" style="text-align: center; padding: 1.5rem; background: var(--np-surface);">
                                    <div style="font-size: 2.5rem; font-weight: bold; color: var(--np-success);">{{ statistics.wins ?? 0 }}</div>
                                    <div class="np-text-muted">Wins</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="np-card" style="text-align: center; padding: 1.5rem; background: var(--np-surface);">
                                    <div style="font-size: 2.5rem; font-weight: bold; color: var(--np-danger);">{{ statistics.losses ?? 0 }}</div>
                                    <div class="np-text-muted">Losses</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="np-card" style="text-align: center; padding: 1.5rem; background: var(--np-surface);">
                                    <div style="font-size: 2.5rem; font-weight: bold; color: var(--np-primary);">{{ statistics.win_rate ?? 0 }}%</div>
                                    <div class="np-text-muted">Win Rate</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4">
                                <div class="np-card" style="padding: 1.5rem;">
                                    <h4 style="margin-bottom: 1rem; color: var(--np-info);">‚öîÔ∏è Combat Stats</h4>
                                    <table class="table np-table">
                                        <tbody>
                                            <tr>
                                                <td>Kills</td>
                                                <td style="text-align: right; font-weight: bold;">{{ statistics.kills ?? 0 }}</td>
                                            </tr>
                                            <tr>
                                                <td>Deaths</td>
                                                <td style="text-align: right; font-weight: bold;">{{ statistics.deaths ?? 0 }}</td>
                                            </tr>
                                            <tr>
                                                <td>Assists</td>
                                                <td style="text-align: right; font-weight: bold;">{{ statistics.assists ?? 0 }}</td>
                                            </tr>
                                            <tr>
                                                <td>K/D Ratio</td>
                                                <td style="text-align: right; font-weight: bold;">
                                                    {% if (statistics.deaths ?? 0) > 0 %}
                                                        {{ ((statistics.kills ?? 0) / statistics.deaths)|number_format(2) }}
                                                    {% else %}
                                                        {{ statistics.kills ?? 0 }}
                                                    {% endif %}
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            
                            <div class="col-md-4">
                                <div class="np-card" style="padding: 1.5rem;">
                                    <h4 style="margin-bottom: 1rem; color: var(--np-warning);">üèÜ Achievements</h4>
                                    {% if statistics.achievements is defined and statistics.achievements is not empty %}
                                        <ul style="list-style: none; padding: 0;">
                                            {% for achievement in statistics.achievements %}
                                                <li style="padding: 0.5rem 0; border-bottom: 1px solid var(--np-border);">
                                                    üèÖ {{ achievement }}
                                                </li>
                                            {% endfor %}
                                        </ul>
                                    {% else %}
                                        <p class="np-text-muted">No achievements yet. Keep playing!</p>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="col-md-4">
                                <div class="np-card" style="padding: 1.5rem;">
                                    <h4 style="margin-bottom: 1rem; color: var(--np-success);">üìà Progress</h4>
                                    <div style="margin-bottom: 1rem;">
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                            <span>Current Score</span>
                                            <span style="font-weight: bold;">{{ player.score }}</span>
                                        </div>
                                        <div style="background: var(--np-border); height: 8px; border-radius: 4px; overflow: hidden;">
                                            <div style="background: var(--np-primary); height: 100%; width: {{ min((player.score / 2000) * 100, 100) }}%;"></div>
                                        </div>
                                        <small class="np-text-muted">{{ 2000 - player.score }} points to Diamond</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% else %}
                        <div class="np-empty" style="text-align: center; padding: 3rem;">
                            <div style="font-size: 4rem; margin-bottom: 1rem;">üìä</div>
                            <h3>No Statistics Yet</h3>
                            <p class="np-text-muted">Start playing matches to see your statistics here!</p>
                        </div>
                    {% endif %}
                    
                    {% if is_granted('PLAYER_PROFILE_EDIT', player) %}
                        <hr style="border-color: var(--np-border); margin: 2rem 0;">
                        <div>
                            <h4 style="margin-bottom: 1rem;">Update Statistics</h4>
                            <form method="post" action="{{ path('app_player_update_stats', {'id': player.id}) }}" class="row">
                                <div class="col-md-2 mb-2">
                                    <input type="number" name="stats[matches_played]" class="form-control" placeholder="Matches" min="0">
                                </div>
                                <div class="col-md-2 mb-2">
                                    <input type="number" name="stats[wins]" class="form-control" placeholder="Wins" min="0">
                                </div>
                                <div class="col-md-2 mb-2">
                                    <input type="number" name="stats[losses]" class="form-control" placeholder="Losses" min="0">
                                </div>
                                <div class="col-md-2 mb-2">
                                    <input type="number" name="stats[kills]" class="form-control" placeholder="Kills" min="0">
                                </div>
                                <div class="col-md-2 mb-2">
                                    <input type="number" name="stats[deaths]" class="form-control" placeholder="Deaths" min="0">
                                </div>
                                <div class="col-md-2 mb-2">
                                    <button type="submit" class="btn btn-primary w-100">Update</button>
                                </div>
                            </form>
                            <small class="np-text-muted">Note: Score and rank will be updated automatically based on your performance.</small>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

