{% extends 'base.html.twig' %}

{% block title %}{{ player.nickname }} - Player Profile{% endblock %}

{% block stylesheets %}
{{ parent() }}
<style>
.player-profile { background: #0d0d0d; color: #fff; min-height: 100vh; padding: 20px 0; }
.player-header { background: linear-gradient(135deg, #1a1a2e 0%, #0d0d0d 100%); border-radius: 12px; padding: 30px; margin-bottom: 20px; display: flex; gap: 30px; align-items: center; }
.player-image { width: 200px; height: 200px; border-radius: 8px; object-fit: cover; border: 3px solid #4a9eff; }
.player-info h1 { font-size: 2.5rem; font-weight: 700; margin: 0 0 10px 0; text-transform: uppercase; }
.player-meta { color: #888; font-size: 0.9rem; margin-bottom: 20px; }
.stat-bars { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 20px; }
.stat-bar { display: flex; align-items: center; gap: 10px; }
.stat-bar label { width: 60px; font-size: 0.8rem; color: #888; text-transform: uppercase; }
.stat-bar .bar { flex: 1; height: 8px; background: #2a2a3e; border-radius: 4px; overflow: hidden; }
.stat-bar .bar-fill { height: 100%; background: linear-gradient(90deg, #4a9eff, #6b5ce7); border-radius: 4px; }
.stat-bar .value { width: 40px; text-align: right; font-weight: 600; color: #4a9eff; }
.section-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin: 20px 0; }
.section-card { background: #1a1a2e; border-radius: 8px; padding: 15px; }
.section-card h4 { font-size: 0.75rem; text-transform: uppercase; color: #888; margin: 0 0 10px 0; }
.metrics-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-top: 20px; }
.metric-card { background: #1a1a2e; border-radius: 8px; padding: 20px; }
.metric-card h3 { font-size: 0.9rem; text-transform: uppercase; margin: 0 0 15px 0; }
.rank-badge { display: inline-block; padding: 5px 15px; background: linear-gradient(135deg, #4a9eff, #6b5ce7); border-radius: 20px; font-size: 0.8rem; font-weight: 600; }
.pro-badge { display: inline-block; padding: 3px 10px; background: gold; color: #000; border-radius: 15px; font-size: 0.7rem; font-weight: 700; margin-left: 10px; }
</style>
{% endblock %}

{% block body %}
<div class="player-profile">
    <div class="container">
        <div class="player-header">
            {% if player.profilePicture %}
                <img src="{{ asset('uploads/logos/' ~ player.profilePicture) }}" alt="{{ player.nickname }}" class="player-image">
            {% else %}
                <div class="player-image" style="display: flex; align-items: center; justify-content: center; background: #2a2a3e; font-size: 4rem;">ðŸŽ®</div>
            {% endif %}
            <div class="player-info" style="flex: 1;">
                <h1>{{ player.nickname }}</h1>
                <div class="player-meta">
                    {{ player.role|default('Player') }} 
                    {% if player.team %}| {{ player.team.name }}{% endif %}
                    {% if player.nationality %}| {{ player.nationality }}{% endif %}
                </div>
                <div>
                    <span class="rank-badge">{{ player.getRank() }}</span>
                    {% if player.isPro %}<span class="pro-badge">PRO</span>{% endif %}
                </div>
                {% if statistic %}
                <div class="stat-bars">
                    <div class="stat-bar">
                        <label>Rating</label>
                        <div class="bar"><div class="bar-fill" style="width: {{ min(player.score/50, 100) }}%"></div></div>
                        <span class="value">{{ (player.score/100)|number_format(2) }}</span>
                    </div>
                    <div class="stat-bar">
                        <label>Win Rate</label>
                        <div class="bar"><div class="bar-fill" style="width: {{ statistic.winRate }}%"></div></div>
                        <span class="value">{{ statistic.winRate }}%</span>
                    </div>
                    <div class="stat-bar">
                        <label>K/D</label>
                        <div class="bar"><div class="bar-fill" style="width: {{ min((statistic.kills/max(statistic.deaths,1))*10, 100) }}%"></div></div>
                        <span class="value">{{ (statistic.kills/max(statistic.deaths,1))|number_format(2) }}</span>
                    </div>
                    <div class="stat-bar">
                        <label>Kills</label>
                        <div class="bar"><div class="bar-fill" style="width: {{ min(statistic.kills/10, 100) }}%"></div></div>
                        <span class="value">{{ statistic.kills }}</span>
                    </div>
                    <div class="stat-bar">
                        <label>Deaths</label>
                        <div class="bar"><div class="bar-fill" style="width: {{ min(statistic.deaths/10, 100) }}%; background: #ff4757;"></div></div>
                        <span class="value" style="color: #ff4757;">{{ statistic.deaths }}</span>
                    </div>
                    <div class="stat-bar">
                        <label>Assists</label>
                        <div class="bar"><div class="bar-fill" style="width: {{ min(statistic.assists/10, 100) }}%"></div></div>
                        <span class="value">{{ statistic.assists }}</span>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
        <div class="section-grid">
            <div class="section-card">
                <h4>Matches</h4>
                <div style="font-size: 1.5rem; font-weight: 700;">{{ statistic ? statistic.matchesPlayed : 0 }}</div>
            </div>
            <div class="section-card">
                <h4>Wins</h4>
                <div style="font-size: 1.5rem; font-weight: 700; color: #2ed573;">{{ statistic ? statistic.wins : 0 }}</div>
            </div>
            <div class="section-card">
                <h4>Losses</h4>
                <div style="font-size: 1.5rem; font-weight: 700; color: #ff4757;">{{ statistic ? statistic.losses : 0 }}</div>
            </div>
            <div class="section-card">
                <h4>Score</h4>
                <div style="font-size: 1.5rem; font-weight: 700; color: #4a9eff;">{{ player.score }}</div>
            </div>
        </div>
        <div class="metrics-grid">
            <div class="metric-card">
                <h3>Performance Stats</h3>
                <table class="table" style="color: #fff; font-size: 0.9rem;">
                    <tr><td style="color: #888;">Game</td><td style="text-align: right; font-weight: 600;">{{ player.game.name }}</td></tr>
                    <tr><td style="color: #888;">Team</td><td style="text-align: right; font-weight: 600;">{{ player.team ? player.team.name : 'Free Agent' }}</td></tr>
                    <tr><td style="color: #888;">Role</td><td style="text-align: right; font-weight: 600;">{{ player.role|default('Not set') }}</td></tr>
                    <tr><td style="color: #888;">Kills/Game</td><td style="text-align: right; font-weight: 600;">{{ statistic ? (statistic.kills/max(statistic.matchesPlayed,1))|number_format(1) : '0.0' }}</td></tr>
                    <tr><td style="color: #888;">Deaths/Game</td><td style="text-align: right; font-weight: 600;">{{ statistic ? (statistic.deaths/max(statistic.matchesPlayed,1))|number_format(1) : '0.0' }}</td></tr>
                </table>
            </div>
            <div class="metric-card">
                <h3>Win Rate</h3>
                {% if statistic and statistic.matchesPlayed > 0 %}
                    <div style="text-align: center; padding: 20px 0;">
                        <div style="font-size: 3rem; font-weight: 700; color: #4a9eff;">{{ statistic.winRate }}%</div>
                        <div style="color: #888; font-size: 0.8rem;">WIN RATE</div>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: 15px;">
                        <div style="text-align: center;"><div style="color: #2ed573; font-weight: 600;">{{ statistic.wins }}</div><div style="font-size: 0.7rem; color: #888;">WINS</div></div>
                        <div style="text-align: center;"><div style="color: #ff4757; font-weight: 600;">{{ statistic.losses }}</div><div style="font-size: 0.7rem; color: #888;">LOSSES</div></div>
                    </div>
                {% else %}
                    <div style="text-align: center; padding: 40px 0; color: #888;">No matches</div>
                {% endif %}
            </div>
        </div>
        {% if isOwner and not player.isPro %}
        <div class="metric-card" style="margin-top: 20px;">
            <h3>Become PRO</h3>
            <p style="color: #888; font-size: 0.9rem;">
                Take a short skill test to try to become a PRO player.
                If you donâ€™t reach 100 points yet, you can book a coaching session or watch coaching guides to improve.
            </p>
            <div class="d-flex gap-2 flex-wrap">
                <a href="{{ path('app_player_pro_test', {'id': player.id}) }}" class="btn btn-primary" style="background: linear-gradient(135deg, #4a9eff, #6b5ce7); border: none;">
                    Take PRO Test
                </a>
                <a href="{{ path('front_coaching_new', {'id': player.id}) }}" class="btn btn-outline-light">
                    Book Coaching Session
                </a>
                <a href="{{ path('front_content_index') }}" class="btn btn-outline-light">
                    View Coaching Guides
                </a>
            </div>
        </div>
        {% endif %}
        {% if isOwner %}
        <div class="metric-card" style="margin-top: 20px;">
            <h3>Update Statistics</h3>
            <form method="post" action="{{ path('app_player_classify', {'id': player.id}) }}" class="row g-3">
                <div class="col-md-2"><input type="number" name="wins" class="form-control" placeholder="Wins" min="0" required style="background: #2a2a3e; border: none; color: #fff;"></div>
                <div class="col-md-2"><input type="number" name="losses" class="form-control" placeholder="Losses" min="0" required style="background: #2a2a3e; border: none; color: #fff;"></div>
                <div class="col-md-2"><input type="number" name="kills" class="form-control" placeholder="Kills" min="0" required style="background: #2a2a3e; border: none; color: #fff;"></div>
                <div class="col-md-2"><input type="number" name="deaths" class="form-control" placeholder="Deaths" min="0" required style="background: #2a2a3e; border: none; color: #fff;"></div>
                <div class="col-md-2"><input type="number" name="assists" class="form-control" placeholder="Assists" min="0" required style="background: #2a2a3e; border: none; color: #fff;"></div>
                <div class="col-md-2"><button type="submit" class="btn btn-primary w-100" style="background: linear-gradient(135deg, #4a9eff, #6b5ce7); border: none;">Update</button></div>
            </form>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
